/*! WP User Manager - v1.1.0
 * http://wpusermanager.com
 * Copyright (c) 2015; * Licensed GPLv2+ */
jQuery(document).ready(function(a){var b={init:function(){this.general(),this.restore_emails(),this.drag_and_drop_fields_table(),this.confirm_dialog(),this.admin_upload()},general:function(){a.isFunction(a.fn.select2)&&(jQuery("select.select2").select2({width:"resolve"}),jQuery(".wppf-multiselect, select.select2_multiselect").select2())},restore_emails:function(){a("#wpum-restore-emails").on("click",function(b){if(b.preventDefault(),!confirm(wpum_admin_js.confirm))return!1;var c=a("#wpum_backend_security").val();a.ajax({type:"GET",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_restore_emails",wpum_backend_security:c},beforeSend:function(){a(".wpum-spinner").remove(),a(".wpum-ajax-done-message").remove(),a("#wpum-restore-emails").after('<span id="wpum-spinner" class="spinner wpum-spinner is-active"></span>')},success:function(b){a("#wpum-restore-emails").after('<p class="wpum-ajax-done-message"> <span class="dashicons dashicons-yes"></span> '+b.data.message+"</p>"),a(".wpum-spinner").remove()},error:function(a,b,c){alert(a.responseText)}})})},drag_and_drop_fields_table:function(){a.isFunction(a.fn.sortable)&&a(".users_page_wpum-profile-fields tbody").sortable({helper:this.sortable_table_fix,axis:"y",cursor:"pointer",opacity:.5,placeholder:"row-dragging",delay:150,handle:".column-order, .move-field",update:function(c,d){a(this).children("tr").each(function(){a(this).data("priority",a(this).index())}),dataArray=a.map(a(this).children("tr"),function(b){return{priority:a(b).data("priority"),field_id:a(b).data("field-id")}});var e=a("#wpum_fields_editor_nonce").val();a.ajax({type:"POST",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_update_fields_order",items:dataArray,wpum_editor_nonce:e},beforeSend:function(){b.display_loader(),b.remove_message()},success:function(c){a(".users_page_wpum-profile-fields").find("tr").removeClass("alternate"),a(".users_page_wpum-profile-fields").find("tr:even").addClass("alternate"),b.hide_loader(),b.display_success_message(".wpum-page-title",c.data.message)},error:function(a,b,c){alert(a.responseText)}})}}).disableSelection()},sortable_table_fix:function(b,c){var d=c.children(),e=c.clone();return e.children().each(function(b){a(this).width(d.eq(b).width())}),e},display_loader:function(){var b=a(".wp-list-table").height();a(".wpum-table-loader").css("display","table"),a(".wpum-table-loader").css("height",b),a(".wpum-table-loader #wpum-spinner").addClass("is-active")},hide_loader:function(){a(".wpum-table-loader").hide(),a(".wpum-table-loader #wpum-spinner").removeClass("is-active")},display_success_message:function(b,c,d,e){return d=d||"updated",e=e||!0,a(b).after('<div class="wpum-message '+d+' notice is-dismissible"><p>'+c+"</p></div>"),e?(a("html, body").animate({scrollTop:0},"slow"),!1):void 0},remove_message:function(){a(".wpum-message").remove()},confirm_dialog:function(){a("#wpum-group-settings-edit a.submitdelete, .wpum-confirm-dialog").click(function(a){return confirm(wpum_admin_js.confirm)})},admin_upload:function(){var b;window.formfield="",a(document.body).on("click",".wpum_settings_upload_button",function(c){c.preventDefault();a(this);return window.formfield=a(this).parent().prev(),b?void b.open():(b=wp.media.frames.file_frame=wp.media({title:wpum_admin_js.upload_title,button:{text:wpum_admin_js.use_this_file},multiple:!1}),b.on("select",function(){attachment=b.state().get("selection").first().toJSON(),window.formfield.val(attachment.url)}),void b.open())})}};b.init(),jQuery("#wpum_dashboard_users").length&&a.ajax({type:"GET",data:{action:"wpum_load_dashboard_users_overview"},url:wpum_admin_js.ajax,success:function(b){a("#wpum_dashboard_users .inside").html(b)}})});